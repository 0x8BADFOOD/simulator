version: "2.4"

services:
  build-webui:
    image: node:10.15-slim
    user: ${UID}
    volumes:
      - ..:/mnt
      - /etc/localtime:/etc/localtime:ro
    command: "/mnt/Docker/docker-webui.sh"

  build-simulator:
    build: .
    image: ${SIMULATOR_DOCKER_IMAGE}
    user: ${UID}
    environment:
      - JENKINS_BUILD_ID
      - GIT_COMMIT
      - GIT_BRANCH
      - SKIP_BUNDLES
      - SKIP_PLAYER
      - UNITY_USERNAME
      - UNITY_PASSWORD
      - UNITY_SERIAL
      - DISPLAY
      - XAUTHORITY=/tmp/.Xauthority
    volumes:
      - ..:/mnt
      - /etc/localtime:/etc/localtime:ro
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ${HOME}/.Xauthority:/tmp/.Xauthority
    runtime: "nvidia"
    privileged: true
    entrypoint: "/mnt/Docker/docker-entry.sh"
