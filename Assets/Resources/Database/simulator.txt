DROP TABLE IF EXISTS maps;
CREATE TABLE maps (
	id INTEGER PRIMARY KEY,
	name VARCHAR(128) NOT NULL,
	url VARCHAR(1024) UNIQUE NOT NULL,
	previewUrl VARCHAR(1024),
	localPath VARCHAR(1024),
	status VARCHAR(64),
	error VARCHAR(512) DEFAULT NULL
);

CREATE INDEX maps_name_index ON maps (name);

DROP TABLE IF EXISTS vehicles;
CREATE TABLE vehicles (
	id INTEGER PRIMARY KEY,
	name VARCHAR(128) NOT NULL,
	url VARCHAR(1024) NOT NULL,
	bridgeType VARCHAR(128) DEFAULT NULL,
	previewUrl VARCHAR(1024),
	localPath VARCHAR(1024),
	sensors TEXT DEFAULT NULL,
	status VARCHAR(64),
	error VARCHAR(512) DEFAULT NULL
);

CREATE INDEX vehicles_name_index ON vehicles (name);

DROP TABLE IF EXISTS clusters;
CREATE TABLE clusters (
	id INTEGER PRIMARY KEY,
	status VARCHAR(64),
	name VARCHAR(128) NOT NULL,
	ips VARCHAR(1024) DEFAULT NULL
);

CREATE INDEX clusters_name_index ON clusters (name);

DROP TABLE IF EXISTS simulations;
CREATE TABLE simulations (
	id INTEGER PRIMARY KEY,
	name VARCHAR(128) NOT NULL,
	cluster INTEGER DEFAULT NULL,
	map INTEGER DEFAULT NULL,
	apiOnly BOOLEAN DEFAULT FALSE,
	interactive BOOLEAN DEFAULT FALSE,
	headless BOOLEAN DEFAULT FALSE,
	timeOfDay DATETIME DEFAULT NOW,
	status VARCHAR(64),
	rain FLOAT DEFAULT 0.0,
	fog FLOAT DEFAULT 0.0,
	wetness FLOAT DEFAULT 0.0,
	cloudiness FLOAT DEFAULT 0.0,
	seed INTEGER DEFAULT NULL,
	useTraffic BOOL DEFAULT FALSE,
	useBicyclists BOOL DEFAULT FALSE,
	usePedestrians BOOL DEFAULT FALSE,

	FOREIGN KEY (cluster) REFERENCES clusters(id),
	FOREIGN KEY (map) REFERENCES maps(id)
);

CREATE INDEX simulations_name_index ON simulations (name);

DROP TABLE IF EXISTS connections;
CREATE TABLE connections (
	id INTEGER PRIMARY KEY,
	simulation INTEGER NOT NULL,
	vehicle INTEGER NOT NULL,
	connection VARCHAR(256) DEFAULT NULL,

	FOREIGN KEY (simulation) REFERENCES simulations(id),
	FOREIGN KEY (vehicle) REFERENCES vehicles(id)
);

CREATE INDEX connections_simulation_vehicle_index ON connections (simulation, vehicle);
CREATE INDEX connections_vehicle_index ON connections (vehicle);

PRAGMA table_info(maps);
PRAGMA table_info(vehicles);
PRAGMA table_info(clusters);
PRAGMA table_info(simulations);
PRAGMA table_info(connections);

INSERT INTO clusters(id, name, status, ips)
VALUES(0, 'Local Machine', 'Valid', '127.0.0.1');
